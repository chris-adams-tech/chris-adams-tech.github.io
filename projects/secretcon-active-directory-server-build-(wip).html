<!DOCTYPE html> <html><head>
		<title>Secretcon Active Directory server build (WIP)</title>
		<base href="../">
		<meta id="root-path" root-path="../">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="Chris' Cyber Garden - Secretcon Active Directory server build (WIP)">
		<meta property="og:title" content="Secretcon Active Directory server build (WIP)">
		<meta property="og:description" content="Chris' Cyber Garden - Secretcon Active Directory server build (WIP)">
		<meta property="og:type" content="website">
		<meta property="og:url" content="https://chris-adams-tech.github.io/projects/secretcon-active-directory-server-build-(wip).html">
		<meta property="og:image" content="https://chris-adams-tech.github.io/projects/img/sc-ms-os-setup.png">
		<meta property="og:site_name" content="Chris' Cyber Garden">
		<meta name="author" content="Chris Adams"><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://chris-adams-tech.github.io/lib/rss.xml"><script async="" id="webpage-script" src="lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script type="module" async="" id="graph-view-script" src="lib/scripts/graph-view.js"></script><script async="" id="graph-wasm-script" src="lib/scripts/graph-wasm.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="graph-render-worker-script" src="lib/scripts/graph-render-worker.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="tinycolor-script" src="lib/scripts/tinycolor.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="pixi-script" src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><link rel="icon" href="lib/media/favicon.jpg"><script async="" id="graph-data-script" src="lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute(&quot;loaded&quot;, &quot;true&quot;)"></script><style>body{--line-width:40em;--line-width-adaptive:40em;--file-line-width:40em;--sidebar-width:min(20em, 80vw);--collapse-arrow-size:11px;--tree-horizontal-spacing:0.6em;--tree-vertical-spacing:0.6em;--sidebar-margin:12px}.sidebar{height:100%;min-width:calc(var(--sidebar-width) + var(--divider-width-hover));max-width:calc(var(--sidebar-width) + var(--divider-width-hover));font-size:14px;z-index:10;position:relative;overflow:hidden;transition:min-width ease-in-out,max-width ease-in-out;transition-duration:.2s;contain:size}.sidebar-left{left:0}.sidebar-right{right:0}.sidebar.is-collapsed{min-width:0;max-width:0}body.floating-sidebars .sidebar{position:absolute}.sidebar-content{height:100%;min-width:calc(var(--sidebar-width) - var(--divider-width-hover));top:0;padding:var(--sidebar-margin);padding-top:4em;line-height:var(--line-height-tight);background-color:var(--background-secondary);transition:background-color,border-right,border-left,box-shadow;transition-duration:var(--color-fade-speed);transition-timing-function:ease-in-out;position:absolute;display:flex;flex-direction:column}.sidebar:not(.is-collapsed) .sidebar-content{min-width:calc(max(100%,var(--sidebar-width)) - 3px);max-width:calc(max(100%,var(--sidebar-width)) - 3px)}.sidebar-left .sidebar-content{left:0;border-top-right-radius:var(--radius-l);border-bottom-right-radius:var(--radius-l)}.sidebar-right .sidebar-content{right:0;border-top-left-radius:var(--radius-l);border-bottom-left-radius:var(--radius-l)}.sidebar:has(.sidebar-content:empty):has(.topbar-content:empty){display:none}.sidebar-topbar{height:2em;width:var(--sidebar-width);top:var(--sidebar-margin);padding-inline:var(--sidebar-margin);z-index:1;position:fixed;display:flex;align-items:center;transition:width ease-in-out;transition-duration:inherit}.sidebar.is-collapsed .sidebar-topbar{width:calc(2.3em + var(--sidebar-margin) * 2)}.sidebar .sidebar-topbar.is-collapsed{width:0}.sidebar-left .sidebar-topbar{left:0}.sidebar-right .sidebar-topbar{right:0}.topbar-content{overflow:hidden;overflow:clip;width:100%;height:100%;display:flex;align-items:center;transition:inherit}.sidebar.is-collapsed .topbar-content{width:0;transition:inherit}.clickable-icon.sidebar-collapse-icon{background-color:transparent;color:var(--icon-color-focused);padding:0!important;margin:0!important;height:100%!important;width:2.3em!important;margin-inline:0.14em!important;position:absolute}.sidebar-left .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);right:var(--sidebar-margin)}.sidebar-right .clickable-icon.sidebar-collapse-icon{transform:rotateY(180deg);left:var(--sidebar-margin)}.clickable-icon.sidebar-collapse-icon svg.svg-icon{width:100%;height:100%}.sidebar-section-header{margin:0 0 1em 0;text-transform:uppercase;letter-spacing:.06em;font-weight:600}body{transition:background-color var(--color-fade-speed) ease-in-out}.webpage-container{display:flex;flex-direction:row;height:100%;width:100%;align-items:stretch;justify-content:center}.document-container{opacity:1;flex-basis:100%;max-width:100%;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;transition:opacity .2s ease-in-out;contain:inline-size}.hide{opacity:0;transition:opacity .2s ease-in-out}.document-container>.markdown-preview-view{margin:var(--sidebar-margin);margin-bottom:0;width:100%;width:-webkit-fill-available;width:-moz-available;width:fill-available;background-color:var(--background-primary);transition:background-color var(--color-fade-speed) ease-in-out;border-top-right-radius:var(--window-radius,var(--radius-m));border-top-left-radius:var(--window-radius,var(--radius-m));overflow-x:hidden!important;overflow-y:auto!important;display:flex!important;flex-direction:column!important;align-items:center!important;contain:inline-size}.document-container>.markdown-preview-view>.markdown-preview-sizer{padding-bottom:80vh!important;width:100%!important;max-width:var(--line-width)!important;flex-basis:var(--line-width)!important;transition:background-color var(--color-fade-speed) ease-in-out;contain:inline-size}.markdown-rendered img:not([width]),.view-content img:not([width]){max-width:100%;outline:0}.document-container>.view-content.embed{display:flex;padding:1em;height:100%;width:100%;align-items:center;justify-content:center}.document-container>.view-content.embed>*{max-width:100%;max-height:100%;object-fit:contain}:has(> :is(.math,table)){overflow-x:auto!important}.document-container>.view-content{overflow-x:auto;contain:content;padding:0;margin:0;height:100%}.scroll-highlight{position:absolute;width:100%;height:100%;pointer-events:none;z-index:1000;background-color:hsla(var(--color-accent-hsl),.25);opacity:0;padding:1em;inset:50%;translate:-50% -50%;border-radius:var(--radius-s)}</style><script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="lib/styles/obsidian.css"><link rel="preload" href="lib/styles/other-plugins.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/other-plugins.css"></noscript><link rel="stylesheet" href="lib/styles/theme.css"><link rel="preload" href="lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/main-styles.css"></noscript><link rel="preload" href="lib/styles/snippets.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="lib/styles/snippets.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title show-ribbon callout-on kanban-full kanban-same-height-cards kanban-full-height-column"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace"><div class="sidebar-left sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"><label class="theme-toggle-container" for="theme_toggle"><input class="theme-toggle-input" type="checkbox" id="theme_toggle"><div class="toggle-background"></div></label></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="search-input-container"><input enterkeyhint="search" type="search" spellcheck="false" placeholder="Search..."><div class="search-input-clear-button" aria-label="Clear search"></div></div><include src="lib/html/file-tree.html"></include></div><script defer="">let ls = document.querySelector(".sidebar-left"); ls.classList.add("is-collapsed"); if (window.innerWidth > 768) ls.classList.remove("is-collapsed"); ls.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-left-width"));</script></div><div class="document-container markdown-reading-view hide"><div class="markdown-preview-view markdown-rendered allow-fold-headings allow-fold-lists is-readable-line-width"><style id="MJX-CHTML-styles"></style><pre class="frontmatter language-yaml" tabindex="0" style="display: none;"><code class="language-yaml is-loaded"><span class="token key atrule">tags</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token key atrule">Owner</span><span class="token punctuation">:</span> Chris Adams
<span class="token key atrule">Last edited time</span><span class="token punctuation">:</span> <span class="token datetime number">2024-10-21</span></code><button class="copy-code-button">Copy</button></pre><div class="markdown-preview-sizer markdown-preview-section"><h1 class="page-title heading inline-title" id="Secretcon Active Directory server build (WIP)"><p dir="auto">Secretcon Active Directory server build (WIP)</p></h1><div class="el-p"><p dir="auto">Writeup and Active Directory build by: Chris Adams<br>
LinkedIn: <a data-tooltip-position="top" aria-label="https://www.linkedin.com/christoph-adams" rel="noopener nofollow" class="external-link" href="https://www.linkedin.com/christoph-adams" target="_blank">www.linkedin.com/in/christoph-adams</a><br>
Website: <a rel="noopener nofollow" class="external-link" href="https://chris-adams.notion.site" target="_blank">https://chris-adams.notion.site</a></p></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">This is the final write-up from the lab below<br>
<a data-href="Vulnerable AD Lab" href="Vulnerable AD Lab" class="internal-link" target="_self" rel="noopener nofollow">Vulnerable AD Lab</a>  </p>
</div></div></div><div class="el-hr"><hr></div><div class="el-h1 heading-wrapper"><h1 data-heading="A bit about this project" dir="auto" class="heading" id="A_bit_about_this_project">A bit about this project</h1><div class="heading-children"><div class="el-hr"><hr></div><div class="el-p"><p dir="auto">The initial build was based off of a vulnerable AD GitHub lab, originally by <strong>safebuffer</strong> <a rel="noopener nofollow" class="external-link" href="https://github.com/safebuffer/vulnerable-AD" target="_blank">https://github.com/safebuffer/vulnerable-AD</a>. I, by no means take any credit for the scripts written in these documents, I merely put pieces together of something that was already created, with hopes to learn from it and continue to expand on it. With that being said, I hope you learn something and can build this on your own, then expand on it as I will continue to.</p></div><div class="el-p"><p dir="auto">Some of the build was based off of work by <em>Joas A Santos</em>. Here is a link to his build:</p></div><div class="el-blockquote"><blockquote dir="auto">
<p><a rel="noopener nofollow" class="external-link" href="https://www.linkedin.com/feed/update/urn:li:activity:7203009970085195777/" target="_blank">https://www.linkedin.com/feed/update/urn:li:activity:7203009970085195777/</a></p>
</blockquote></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="Tools used in this project" dir="auto" class="heading" id="Tools_used_in_this_project">Tools used in this project</h1><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">Active Directory</li>
<li data-line="1" dir="auto">KVM/VMware</li>
<li data-line="2" dir="auto">Ubuntu22.04 (server)</li>
<li data-line="3" dir="auto">Kali Linux</li>
<li data-line="4" dir="auto">OpenSSH (optional)</li>
<li data-line="5" dir="auto">PowerShell<br>
My home lab set up was originally built on Qemu/KVM then we implemented the actual build into Proxmox.<br>
</li>
</ul></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">As of right now, this is only including the Active Directory and Wazuh build along with their respective rulesets.  </p>
</div></div></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">If configuring this in your home network, ensure you are isolating this subnet from the rest of your network with proper bridging/VLANs.  </p>
</div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="Some good prior knowledge to have" dir="auto" class="heading" id="Some_good_prior_knowledge_to_have">Some good prior knowledge to have</h1><div class="heading-children"><div class="el-ul"><ul>
<li data-line="0" dir="auto">Networking (changing IP addresses)</li>
<li data-line="1" dir="auto">PowerShell (executing commands)</li>
<li data-line="2" dir="auto">Setting up virtual machines and/or bridges</li>
</ul></div><div class="el-hr"><hr></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="Active Directory Set up" dir="auto" class="heading" id="Active_Directory_Set_up">Active Directory Set up</h1><div class="heading-children"><div class="el-hr"><hr></div><div class="el-h3 heading-wrapper"><h3 data-heading="Windows Server download" dir="auto" class="heading" id="Windows_Server_download"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Windows Server download</h3><div class="heading-children"><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p>First, download Windows server from the Windows website, the Evaluation version. This allows for 180 days of use for the trial license.</p>
<p><a rel="noopener nofollow" class="external-link" href="https://www.microsoft.com/en-us/evalcenter/download-windows-server-2022" target="_blank">https://www.microsoft.com/en-us/evalcenter/download-windows-server-2022</a></p>
<p><em>(some browsers won’t allow you to view the ISO, if that happens, try from a different browser)</em></p>
</li>
</ol></div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="Steps if installing with the GUI desktop experience" dir="auto" class="heading" id="Steps_if_installing_with_the_GUI_desktop_experience"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Steps if installing with the GUI desktop experience</h3><div class="heading-children"><div class="el-p"><p dir="auto">1.<strong>Choose Windows Server 2022 Standard Evaluation (Desktop Experience)</strong><br>
<span alt="sc-ms-os-setup.png" src="sc-ms-os-setup.png" class="internal-embed media-embed image-embed is-loaded"><img alt="sc-ms-os-setup.png" src="projects/img/sc-ms-os-setup.png"></span><br>
2.<strong>Choose ‘Custom: Install Microsoft Server Operating System’</strong><br>
<span alt="sc-custom-install.png" src="sc-custom-install.png" class="internal-embed media-embed image-embed is-loaded"><img alt="sc-custom-install.png" src="projects/img/sc-custom-install.png"></span></p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p><strong>Select the ‘Unallocated’ drive</strong><br>
<span alt="sc-unallocated.png" src="sc-unallocated.png" class="internal-embed media-embed image-embed is-loaded"><img alt="sc-unallocated.png" src="projects/img/sc-unallocated.png"></span><br>
4.<strong>Change the name of the Computer</strong><br>
<span alt="sc-change-computer.png" src="sc-change-computer.png" class="internal-embed media-embed image-embed is-loaded"><img alt="sc-change-computer.png" src="projects/img/sc-change-computer.png"></span><br>
(Reboot needed)</p>
</li>
<li data-line="6" dir="auto">
<p>Once the Windows Server is installed, open a PowerShell window as Administrator:</p>
</li>
<li data-line="7" dir="auto">
<p>Run the command below to add Domain Services role to Server Manager</p>
</li>
</ol></div><div class="el-pre"><pre class="language-powershell" tabindex="0"><code data-line="0" class="language-powershell is-loaded"> <span class="token function">PS</span> C:\Users\Administrator&gt; 
 <span class="token function">Install-WindowsFeature</span> <span class="token operator">-</span>Name ad-domain-services <span class="token operator">-</span>IncludeManagementTools
</code><button class="copy-code-button">Copy</button></pre></div><div class="el-ol"><ol start="3">
<li data-line="0" dir="auto">Then, run this script to install Active Directory, be sure to change the domain name before executing</li>
</ol></div><div class="el-pre"><pre class="language-powershell" tabindex="0"><code data-line="0" class="language-powershell is-loaded"> <span class="token function">PS</span> C:\Users\Administrator&gt; 
<span class="token function">Install-ADDSForest</span> <span class="token operator">-</span>CreateDnsDelegation:<span class="token boolean">$false</span> <span class="token operator">-</span>DatabasePath <span class="token string">"C:\\Windows\\NTDS"</span> <span class="token operator">-</span>DomainMode <span class="token string">"7"</span> <span class="token operator">-</span>DomainName <span class="token string">"insert.domain"</span> <span class="token operator">-</span>DomainNetbiosName <span class="token string">"domain"</span> <span class="token operator">-</span>ForestMode <span class="token string">"7"</span> <span class="token operator">-</span>InstallDns:<span class="token boolean">$true</span> <span class="token operator">-</span>LogPath <span class="token string">"C:\\Windows\\NTDS"</span> <span class="token operator">-</span>NoRebootOnCompletion:<span class="token boolean">$false</span> <span class="token operator">-</span>SysvolPath <span class="token string">"C:\\Windows\\SYSVOL"</span> <span class="token operator">-</span>Force:<span class="token boolean">$true</span>
</code><button class="copy-code-button">Copy</button></pre></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">
<p><code>Install-ADDSForest</code> - creates a new Active Directory forest</p>
</li>
<li data-line="2" dir="auto">
<p><code>-CreateDnsDelegation</code> - creates DNS delegation that references new DNS server you install along with the domain controller</p>
</li>
<li data-line="4" dir="auto">
<p><code>-DatabasePath</code> - specifies fully qualified, non-Universal Naming Convention (UNC) path to directory — default is %SYSTEMROOT%\NTDS</p>
</li>
<li data-line="6" dir="auto">
<p><code>-DomainMode</code> - specifies domain functional level of first domain in creation of new forest — 7 is Windows Server 2016 or newer</p>
</li>
<li data-line="8" dir="auto">
<p><code>-DomainName</code> - specifies fully qualified domain name (FQDN) for root domain in forest</p>
</li>
<li data-line="10" dir="auto">
<p><code>-DomainNetbiosName</code> - specifies NetBIOS name </p>
</li>
<li data-line="12" dir="auto">
<p><code>-ForestMode</code> - specifies domain functional level of first domain in creation of new forest — 7 is Windows Server 2016 or newer</p>
</li>
<li data-line="14" dir="auto">
<p><code>-InstallDns</code> - indicates cmdlet installs and configures DNS Server service for new forest</p>
</li>
<li data-line="16" dir="auto">
<p><code>-LogPath</code> - specifies fully qualified, non-UNC path to a directory where log file for this operation is written</p>
</li>
<li data-line="17" dir="auto">
<p><code>-NoRebootOnCompletion</code> - indicates cmdlet does not reboot upon completion</p>
</li>
<li data-line="19" dir="auto">
<p><code>-SysvolPath</code> - specifies fully qualified, non-UNC path to a directory where Sysvol file is written</p>
</li>
<li data-line="21" dir="auto">
<p><code>-Force</code> - forces command to run without asking for user confirmation</p>
</li>
</ul></div><div class="el-ol"><ol start="4">
<li data-line="0" dir="auto">The server will then reboot and the next login should be with the domain level domain\user.</li>
</ol></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">This could also be done through an SSH connection and just run the scripts via PuTTy or a terminal window. I did not because OpenSSH does not play nicely from a Linux KVM to Windows machine.  </p>
</div></div></div><div class="el-hr"><hr></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Sysmon Installation" dir="auto" class="heading" id="Sysmon_Installation"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Sysmon Installation</h2><div class="heading-children"><div class="el-hr"><hr></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">In this setup, the Swift on Security configuration file was used and also played around with the Wazuh basic rule set  </p>
</div></div></div><div class="el-p"><p dir="auto">Check out the ruleset here: <a rel="noopener nofollow" class="external-link" href="https://github.com/SwiftOnSecurity/sysmon-config" target="_blank">https://github.com/SwiftOnSecurity/sysmon-config</a><br>
<span alt="sysmon-config.png" src="sysmon-config.png" class="internal-embed media-embed image-embed is-loaded"><img alt="sysmon-config.png" src="lib/media/sysmon-config.png"></span></p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Download the raw xml file in the files below the README.md</li>
</ol></div><div class="el-p"><p dir="auto"><span alt="sysmon-xml.png" src="sysmon-xml.png" class="internal-embed media-embed image-embed is-loaded"><img alt="sysmon-xml.png" src="lib/media/sysmon-xml.png"></span></p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Now, download Sysmon from Windows</li>
</ol></div><div class="el-blockquote"><blockquote dir="auto">
<p><a rel="noopener nofollow" class="external-link" href="https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon" target="_blank">https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon</a></p>
</blockquote></div><div class="el-p"><p dir="auto"><span alt="dl-sysmon.png" src="dl-sysmon.png" class="internal-embed media-embed image-embed is-loaded"><img alt="dl-sysmon.png" src="lib/media/dl-sysmon.png"></span></p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p>Extract the packages from the Sysmon download</p>
</li>
<li data-line="2" dir="auto">
<p>Move the <code>sysmonconfig-export.xml</code> file into the Sysmon folder that was just extracted</p>
</li>
<li data-line="4" dir="auto">
<p>Open PowerShell as administrator and move into the Sysmon folder</p>
</li>
</ol></div><div class="el-pre"><pre class="language-powershell" tabindex="0"><code data-line="0" class="language-powershell is-loaded"> <span class="token function">PS</span> C:\Users\<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>\Downloads\Sysmon&gt; <span class="token punctuation">.</span>\sysmon64<span class="token punctuation">.</span>exe <span class="token operator">-</span>accepteula <span class="token operator">-</span>i sysmonconfig-export<span class="token punctuation">.</span>xml
</code><button class="copy-code-button">Copy</button></pre></div><div class="el-ul"><ul>
<li data-line="0" dir="auto"><code>accepteula</code> - accepts End User License Agreement</li>
<li data-line="1" dir="auto"><code>-i</code> - installs service and driver along with configuration file</li>
</ul></div><div class="el-h3 heading-wrapper"><h3 data-heading="Desktop Instructions" dir="auto" class="heading" id="Desktop_Instructions"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Desktop Instructions</h3><div class="heading-children"></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="Enable PowerShell Module Logging and other GPO settings" dir="auto" class="heading" id="Enable_PowerShell_Module_Logging_and_other_GPO_settings"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Enable PowerShell Module Logging and other GPO settings</h3><div class="heading-children"><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">The PowerShell Module logging, along with other logging settings, will allow us to capture the full output of the scripts that are being run. Of course, it will be captured on the local machine, then forwarded via Powershell logs to Wazuh.  </p>
</div></div></div><div class="el-p"><p dir="auto"><span alt="gpo-dropdown.png" src="gpo-dropdown.png" class="internal-embed media-embed image-embed is-loaded"><img alt="gpo-dropdown.png" src="lib/media/gpo-dropdown.png"></span></p></div><div class="el-p"><p dir="auto"><span alt="gpm.png" src="gpm.png" class="internal-embed media-embed image-embed is-loaded"><img alt="gpm.png" src="lib/media/gpm.png"></span><br>
<span alt="module-logging.png" src="module-logging.png" class="internal-embed media-embed image-embed is-loaded"><img alt="module-logging.png" src="lib/media/module-logging.png"></span><br>
<span alt="sc-audit-policy.png" src="sc-audit-policy.png" class="internal-embed media-embed image-embed is-loaded"><img alt="sc-audit-policy.png" src="projects/img/sc-audit-policy.png"></span></p></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">This will create a text file of the Powershell transcript to verify that the logs are being received in the intended manner.  </p>
</div></div></div><div class="el-hr"><hr></div></div></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="Download the PowerShell script" dir="auto" class="heading" id="Download_the_PowerShell_script">Download the PowerShell script</h1><div class="heading-children"><div class="el-hr"><hr></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">To download directly from GitHub</li>
</ol></div><div class="el-pre"><pre class="language-powershell" tabindex="0"><code data-line="0" class="language-powershell is-loaded"><span class="token function">PS</span> C:\Users\Administrator&gt; 
wget https:<span class="token operator">/</span><span class="token operator">/</span>raw<span class="token punctuation">.</span>githubusercontent<span class="token punctuation">.</span>com/WaterExecution/vulnerable-AD-plus/master/vulnadplus<span class="token punctuation">.</span>ps1 <span class="token operator">-</span>o vulnadplus<span class="token punctuation">.</span>ps1
</code><button class="copy-code-button">Copy</button></pre></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">-o` - saves the output file to vulnadplus.ps1</li>
</ul></div><div class="el-p"><p dir="auto">In the screenshot below are the types of attacks that can be implemented in this lab environment. These may be adjusted by going into the <code>vulnadplus.ps1</code> script BEFORE running to adjust to your purposes.</p></div><div class="el-p"><p dir="auto"><span alt="vulnad.png" src="vulnad.png" class="internal-embed media-embed image-embed is-loaded"><img alt="vulnad.png" src="lib/media/vulnad.png"></span></p></div><div class="el-ol"><ol start="2">
<li data-line="0" dir="auto">Open the PowerShell file with notepad to adjust the domain name and number of desired users</li>
</ol></div><div class="el-p"><p dir="auto"><span alt="sc-ps-output.png" src="sc-ps-output.png" class="internal-embed media-embed image-embed is-loaded"><img alt="sc-ps-output.png" src="projects/img/sc-ps-output.png"></span></p></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">Changing the domain name is a crucial step! I also do not recommend using 100 users to start out. Keep it simple at first, then expand from there.  </p>
</div></div></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p>Before running the script, we want to ensure there is no connectivity to the internet and the DNS is set to it’s own IP address, or loopback <code>127.0.0.1</code>.</p>
<p><strong>Set your network on this device to ‘isolated’ so it is disconnected from NAT</strong></p>
</li>
<li data-line="6" dir="auto">
<p>Open PowerShell and run the edited PowerShell script</p>
<pre class="language-powershell" tabindex="0"><code data-line="8" class="language-powershell is-loaded"><span class="token function">PS</span> C:\Users\Administrator&gt; 
<span class="token function">Import-Module</span> <span class="token punctuation">.</span>\vulnadplus<span class="token punctuation">.</span>ps1
</code><button class="copy-code-button">Copy</button></pre>
<p>The output will look like below:</p>
<div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">The usernames are randomized fyi  </p>
</div></div>
<pre><code data-line="20">	![[vulnusers.png]]
	![[vulnusers 2.png]]
  ![[badacl.png]]
</code><button class="copy-code-button">Copy</button></pre>
</li>
</ol></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">Another option would be to download the files, scripts, then create a file share, in my case using samba, to the VM in order to not have the host connected to the internet at all.  </p>
</div></div></div><div class="el-hr"><hr></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="Install Wazuh" dir="auto" class="heading" id="Install_Wazuh">Install Wazuh</h1><div class="heading-children"><div class="el-hr"><hr></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">Wazuh is a open-source security platform that provides unified XDR and SIEM protection for endpoints and cloud workloads.  </p>
</div></div></div><div class="el-p"><p dir="auto">Three main components to <em>Wazuh</em>:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto"><em>Wazuh</em> server</li>
<li data-line="1" dir="auto"><em>Wazuh</em> indexer</li>
<li data-line="2" dir="auto"><em>Wazuh</em> dashboard</li>
</ol></div><div class="el-p"><p dir="auto">Hardware requirements:</p></div><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th dir="ltr"><strong>Agents</strong></th>
<th dir="ltr"><strong>CPU</strong></th>
<th dir="ltr"><strong>RAM</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td dir="auto"><strong>1–25</strong></td>
<td dir="ltr">4 vCPU</td>
<td dir="ltr">8 GiB</td>
</tr>
<tr>
<td dir="auto"><strong>25–50</strong></td>
<td dir="ltr">8 vCPU</td>
<td dir="ltr">8 GiB</td>
</tr>
<tr>
<td dir="auto"><strong>50–100</strong></td>
<td dir="ltr">8 vCPU</td>
<td dir="ltr">8 GiB</td>
</tr>
</tbody>
</table></div><div class="el-p"><p dir="auto">Operating System</p></div><div class="el-table" dir="ltr" style="overflow-x: auto;"><table>
<thead>
<tr>
<th dir="ltr">Amazon Linux 2</th>
<th dir="ltr">CentOS 7, 8</th>
</tr>
</thead>
<tbody>
<tr>
<td dir="ltr"><strong>Red Hat Enterprise Linux 7, 8, 9</strong></td>
<td dir="ltr"><strong>Ubuntu 16.04, 18.04, 20.04, 22.04</strong></td>
</tr>
</tbody>
</table></div><div class="el-p"><p dir="auto">Browser compatibibility:</p></div><div class="el-ul"><ul>
<li data-line="0" dir="auto">Chrome 95 or later</li>
<li data-line="1" dir="auto">Firefox 93 or later</li>
<li data-line="2" dir="auto">Safari 13.7 or later</li>
</ul></div><div class="el-h2 heading-wrapper"><h2 data-heading="Installing Wazuh dashboard" dir="auto" class="heading" id="Installing_Wazuh_dashboard"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Installing Wazuh dashboard</h2><div class="heading-children"><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">Before beginning, a virtual machine with an operating system from above will need to be booted up. In this project, we used Ubuntu 22.04 but any of the mentioned will be okay, as long as the hardware requirements are met (There were some issues with using low RAM).  </p>
</div></div></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Begin by connecting or opening an SSH connection into your virtual machine.</li>
</ol></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">For password-less SSH connection, on your host machine run ssh-keygen -t ed25519 to generate an SSH key. Then, run ssh-copy-id @. There should be a prompt to enter your VM user password. Verify that you are able to connect, then you are able to run the commands from your host machine via an SSH connection.  </p>
</div></div></div><div class="el-p"><p dir="auto">Wazuh can easily installed by using the installation assistant by using the script below:</p></div><div class="el-pre"><pre><code data-line="0">curl -sO https://packages.wazuh.com/4.8/wazuh-install.sh &amp;&amp; sudo bash ./wazuh-install.sh -a
</code><button class="copy-code-button">Copy</button></pre></div><div class="el-p"><p dir="auto"><span alt="image.png" src="image.png" class="internal-embed is-loaded file-embed mod-empty-attachment">“image.png” could not be found.</span><br>
The output will look similar to below:</p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p>Once finished, the password will be displayed in the output.<br>
<span alt="image 1.png" src="image 1.png" class="internal-embed is-loaded file-embed mod-empty-attachment">“image 1.png” could not be found.</span></p>
</li>
<li data-line="3" dir="auto">
<p>To access the web interface, go to <code>https://&lt;wazuh-dashboard-ip&gt;</code> on your host machine, using the credentials from the output in the last step.</p>
</li>
</ol></div><div class="el-p"><p dir="auto">There will be a notice that “Your connection is not private” and is expected. Click <strong>Advanced</strong> and <strong>Proceed to</strong> <em><strong></strong></em> <strong>(unsafe)</strong><br>
<span alt="image 2.png" src="image 2.png" class="internal-embed is-loaded file-embed mod-empty-attachment">“image 2.png” could not be found.</span></p></div><div class="el-p"><p dir="auto">Then, a login screen will appear, where you can enter in the credentials <strong>“admin</strong>” and the password that was generated with the installation.</p></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">This password can be changed but requires a few steps to sync the API and other backend passwords.  </p>
</div></div></div><div class="el-p"><p dir="auto"><span alt="image 3.png" src="image 3.png" class="internal-embed is-loaded file-embed mod-empty-attachment">“image 3.png” could not be found.</span></p></div><div class="el-p"><p dir="auto">After entering the correct credentials, there will be some checks to ensure that everything was configured correctly on the backend<br>
<span alt="image 4.png" src="image 4.png" class="internal-embed is-loaded file-embed mod-empty-attachment">“image 4.png” could not be found.</span></p></div><div class="el-p"><p dir="auto">Once connected, you should have landed on a page like this:<br>
<span alt="image 5.png" src="image 5.png" class="internal-embed is-loaded file-embed mod-empty-attachment">“image 5.png” could not be found.</span></p></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p>Once on the web interface, add an agent from the Overview page on the Wazuh dashboard</p>
<p>Click the “Add agent”</p>
<p><span alt="add-agent.png" src="add-agent.png" class="internal-embed is-loaded file-embed mod-empty-attachment">“add-agent.png” could not be found.</span></p>
<p><span alt="Untitled 13 2.png" src="Untitled 13 2.png" class="internal-embed is-loaded file-embed mod-empty-attachment">“Untitled 13 2.png” could not be found.</span></p>
</li>
</ol></div><div class="el-p"><p dir="auto"><em>This will allow you to generate a agent deploy script for your Active Directory domain controller</em></p></div><div class="el-p"><p dir="auto">The script will look something like this</p></div><div class="el-pre"><pre class="language-powershell" tabindex="0"><code data-line="0" class="language-powershell is-loaded"><span class="token function">Invoke-WebRequest</span> <span class="token operator">-</span>Uri https:<span class="token operator">/</span><span class="token operator">/</span>packages<span class="token punctuation">.</span>wazuh<span class="token punctuation">.</span>com/4<span class="token punctuation">.</span>x/windows/wazuh-agent-4<span class="token punctuation">.</span>8<span class="token punctuation">.</span>0-1<span class="token punctuation">.</span>msi <span class="token operator">-</span>OutFile $<span class="token punctuation">{</span>env<span class="token punctuation">.</span>tmp<span class="token punctuation">}</span>\wazuh-agent<span class="token punctuation">;</span> msiexec<span class="token punctuation">.</span>exe <span class="token operator">/</span>i $<span class="token punctuation">{</span>env<span class="token punctuation">.</span>tmp<span class="token punctuation">}</span>\wazuh-agent <span class="token operator">/</span>q WAZUH_MANAGER=<span class="token string">'&lt;manager-ip&gt;'</span> WAZUH_AGENT_GROUP=<span class="token string">'&lt;group-name&gt;'</span> WAZUH_AGENT_NAME=<span class="token string">'&lt;agent-name&gt;'</span> 
</code><button class="copy-code-button">Copy</button></pre></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">This may be tricky to copy/paste depending on the type of hardware you are using. I use spice-vdagent for my Linux machine.  </p>
</div></div></div><div class="el-h3 heading-wrapper"><h3 data-heading="Now, shift back to the domain controller with Active Directory" dir="auto" class="heading" id="Now,_shift_back_to_the_domain_controller_with_Active_Directory"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Now, shift back to the domain controller with Active Directory</h3><div class="heading-children"><div class="el-ol"><ol>
<li data-line="0" dir="auto">Verify there were no errors, then run <code>NET START WazuhSvc</code> (this will start the Wazuh service)</li>
<li data-line="1" dir="auto">After a few moments, a <em>Disconnected</em> agent should appear in the Wazuh dashboard</li>
<li data-line="2" dir="auto">Shortly after, it should show as <em>Connected.</em></li>
<li data-line="3" dir="auto">On initial boot, if the settings are not changed, there will be a host of logs from the CIS benchmark scan. <em>These can be disabled in the</em> <code>ossec.conf</code> <em>file.</em></li>
</ol></div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">In order for alerts to be sent to Wazuh, some configuration in the ossec.conf file is needed. </p>
</div></div></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">
<p>To configure the Sysmon configuration for the agent, go to <code>C:\'Program Files (x86)'\ossec-agent-ossec.conf</code> (can be opened in notepad)</p>
</li>
<li data-line="2" dir="auto">
<p>Add these two sections (Event Channels) to the configuration file then save</p>
</li>
</ol></div><div class="el-p"><p dir="auto">  ``<br>
<br>
Microsoft-Windows-Sysmon/Operational<br>
&lt;log_format&gt;eventchannel&lt;/log_format&gt;<br>
</p></div><div>    
Microsoft-Windows-PowerShell/Operational
eventchannel

```
    
    &gt; [!important]  
    &gt; Additional event channels can also be added by using the format below, :  
    Microsoft-Windows-PrintService/Operational  
    eventchannel  
      
    ## Options for configuring Windows Event Channels in Wazuh
    
|**Source**|**Channel name**|**Provider name**|**Description**|
    |---|---|---|---|
    |**Application**|Application|Any|This channel collects events related to system application management and is one of the main Windows administrative channels along with Security, and System.|
    |**Security**|Security|Any|This channel gathers information related to user and group creation, login, logoff, and audit policy modifications.|
    |**System**|System|Any|The System channel collects events associated with kernel and service control.|
    |**Sysmon**|Microsoft-Windows-Sysmon/Operational|Microsoft-Windows-Sysmon|Sysmon monitors system activity such as process creation and termination, network connections, and file changes.|
    |**Windows Defender**|Microsoft-Windows-Windows Defender/Operational|Microsoft-Windows-Windows Defender|The Windows Defender log shows information about the scans passed, malware detection, and actions taken against them.|
    |**McAfee**|Application|McLogEvent|This source shows McAfee scan results, virus detection, and actions taken against them.|
    |**EventLog**|System|Eventlog|This source retrieves information about audit and Windows logs.|
    |**Microsoft Security Essentials**|System|Microsoft Antimalware|This source gives information about real-time protection for the system, malware detection scans, and changes in antivirus settings.|
    |**Remote Access**|File Replication Service|Any|Other channels (they are grouped in a generic Windows rule file).|
    |**Terminal Services**|Microsoft-Windows-TerminalServices-RemoteConnectionManager|||
    |**Powershell**|Microsoft-Windows-PowerShell/Operational|Microsoft-Windows-PowerShell|This channel collects and audits PowerShell activity.|
    
    Additionally, the logging level can be adjusted. It will only send alerts higher than configured.
    
    ```XML
      
      
        9 # Alert level can be adjusted
        192.168.10.1 # If level higher than 9, also sent here 
      
      
      
        192.168.10.2 # All alerts are sent here
      
    
    ```
    
    If you would like to disable the CIS benchmark scans, change the field in the config
    
    ```XML
      
      
        yes
        1800
        1d
        no
    ```
    
    There are many other settings that can be adjusted in this file that we will not get into here.
    
    &gt; [!important]  
    &gt; When changing any of the files, restart the service for the changes to take effect.systemctl restart wazuh-manager  
    
      
    
2. If you are having any communication issues with the agent, check the agent configuration file at `C:\'Program Files (x86)'\ossec-agent-ossec.conf` to verify the Wazuh server IP address.
```XML
    
      <address>'wazuh-server-ip'</address>
      1514
      tcp
    
```
  
_This ensures communication between the agent and server_
# Configuring the alerts on Wazuh server</div><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">In addition to the Sysmon config, the Wazuh server must be configured in order to create alerts on the dashboard. This is where you can use different types of detection logic depending on the data that is captured.Within these rule sets, the field names that are captured from the logs can be used to map event codes and other telemetry to alert levels and your own rule descriptions.  </p>
</div></div></div><div class="el-p"><p dir="auto">Below is the ruleset we used for the environment in the red/blue team village</p></div><div class="el-pre"><pre class="language-xml" tabindex="0"><code data-line="0" class="language-xml is-loaded"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>group</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>security_event, windows,<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
 
  <span class="token comment">&lt;!-- This rule detects DCSync attacks using windows security event on the domain controller --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>110001<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if_sid</span><span class="token punctuation">&gt;</span></span>60103<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if_sid</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.system.eventID<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>^4662$<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.properties<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{1131f6aa-9c07-11d1-f79f-00c04fc2dcd2}|{19195a5b-6da0-11d0-afd3-00c04fd930c9}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>options</span><span class="token punctuation">&gt;</span></span>no_full_log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>options</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Directory Service Access. Possible DCSync attack<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
 
 <span class="token comment">&lt;!-- This rule ignores Directory Service Access originating from machine accounts containing $ --&gt;</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>110009<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if_sid</span><span class="token punctuation">&gt;</span></span>60103<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if_sid</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.system.eventID<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>^4662$<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.properties<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{1131f6aa-9c07-11d1-f79f-00c04fc2dcd2}|{19195a5b-6da0-11d0-afd3-00c04fd930c9}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.SubjectUserName<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>\$$<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>options</span><span class="token punctuation">&gt;</span></span>no_full_log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>options</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Ignore all Directory Service Access that is originated from a machine account containing $<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
 
  <span class="token comment">&lt;!-- This rule detects Keberoasting attacks using windows security event on the domain controller --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>110002<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if_sid</span><span class="token punctuation">&gt;</span></span>60103<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if_sid</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.system.eventID<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>^4769$<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.TicketOptions<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>0x40810000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.TicketEncryptionType<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>0x17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>options</span><span class="token punctuation">&gt;</span></span>no_full_log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>options</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Possible Keberoasting attack<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
 
  <span class="token comment">&lt;!-- This rule detects Golden Ticket attacks using windows security events on the domain controller --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>110003<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if_sid</span><span class="token punctuation">&gt;</span></span>60103<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if_sid</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.system.eventID<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>^4624$<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.LogonGuid<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{00000000-0000-0000-0000-000000000000}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.logonType<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>options</span><span class="token punctuation">&gt;</span></span>no_full_log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>options</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Possible Golden Ticket attack<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
 
  <span class="token comment">&lt;!-- This rule detects when PsExec is launched remotely to perform lateral movement within the domain. The rule uses Sysmon events collected from the domain controller. --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>110004<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if_sid</span><span class="token punctuation">&gt;</span></span>61600<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if_sid</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.system.eventID<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>17|18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.PipeName<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>\\PSEXESVC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>options</span><span class="token punctuation">&gt;</span></span>no_full_log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>options</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>PsExec service launched for possible lateral movement within the domain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- This rule detects NTDS.dit file extraction using a sysmon event captured on the domain controller --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>110006<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if_group</span><span class="token punctuation">&gt;</span></span>sysmon_event1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if_group</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.commandLine<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>NTDSUTIL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Possible NTDS.dit file extraction using ntdsutil.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- This rule detects Pass-the-ash (PtH) attacks using windows security event 4624 on the compromised endpoint --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>110007<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if_sid</span><span class="token punctuation">&gt;</span></span>60103<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if_sid</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.system.eventID<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>^4624$<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.LogonProcessName<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>seclogo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.LogonType<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.AuthenticationPackageName<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Negotiate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.LogonGuid<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{00000000-0000-0000-0000-000000000000}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>options</span><span class="token punctuation">&gt;</span></span>no_full_log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>options</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Possible Pass the hash attack<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
  
  <span class="token comment">&lt;!-- This rule detects credential dumping when the command sekurlsa::logonpasswords is run on mimikatz --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>110008<span class="token punctuation">"</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>12<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if_sid</span><span class="token punctuation">&gt;</span></span>61612<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if_sid</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.TargetImage<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>(?i)\\\\system32\\\\lsass.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>field</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>win.eventdata.GrantedAccess<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pcre2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>(?i)0x1010<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>field</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Possible credential dumping using mimikatz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>group</span><span class="token punctuation">&gt;</span></span>
</code><button class="copy-code-button">Copy</button></pre></div><div class="el-p"><p dir="auto">I had some additional rulesets implemented, then unfortunately had to snapshot and did not get these ones back on the machine</p></div><div class="el-pre"><pre class="language-xml" tabindex="0"><code data-line="0" class="language-xml is-loaded"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Sysmon</span> <span class="token attr-name">schemaversion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4.30<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EventFiltering</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RuleGroup</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">groupRelation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>or<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProcessAccess</span> <span class="token attr-name">onmatch</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>include<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Rule</span> <span class="token attr-name">groupRelation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>and<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetImage</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1003,technique_name=Credential Dumping<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>is<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>C:\Windows\system32\csrss.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetImage</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--Mitre T1098--&gt;</span>          <span class="token comment">&lt;!--Mitre T1550.002--&gt;</span>          <span class="token comment">&lt;!--Mitre T1003--&gt;</span>          <span class="token comment">&lt;!-- depending on what you're running on your host, this might be noisy--&gt;</span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>0x1F1FFF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Rule</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Rule</span> <span class="token attr-name">groupRelation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>and<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetImage</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1003,technique_name=Credential Dumping<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>is<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>C:\Windows\system32\wininit.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetImage</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--Mitre T1098--&gt;</span>        <span class="token comment">&lt;!--Mitre T1550.002--&gt;</span>          <span class="token comment">&lt;!--Mitre T1003--&gt;</span>          <span class="token comment">&lt;!-- depending on what you're running on your host, this might be noisy--&gt;</span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>0x1F1FFF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Rule</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Rule</span> <span class="token attr-name">groupRelation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>and<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetImage</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1003,technique_name=Credential Dumping<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>is<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>C:\Windows\system32\winlogon.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetImage</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--Mitre T1098--&gt;</span>       <span class="token comment">&lt;!--Mitre T1550.002--&gt;</span>          <span class="token comment">&lt;!--Mitre T1003--&gt;</span>          <span class="token comment">&lt;!-- depending on what you're running on your host, this might be noisy--&gt;</span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>0x1F1FFF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Rule</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Rule</span> <span class="token attr-name">groupRelation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>and<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetImage</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1003,technique_name=Credential Dumping<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>is<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>C:\Windows\system32\services.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetImage</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--Mitre T1098--&gt;</span>       <span class="token comment">&lt;!--Mitre T1550.002--&gt;</span>          <span class="token comment">&lt;!--Mitre T1003--&gt;</span>          <span class="token comment">&lt;!-- depending on what you're running on your host, this might be noisy--&gt;</span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>0x1F1FFF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- In some environments this causes HIGH CPU usage by sysmon, remove this module when that occurs --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Rule</span> <span class="token attr-name">groupRelation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>and<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetImage</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1003,technique_name=Credential Dumping<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>is<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>C:\Windows\system32\lsass.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetImage</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--Mitre T1098--&gt;</span>          <span class="token comment">&lt;!--Mitre T1550.002--&gt;</span>          <span class="token comment">&lt;!--Mitre T1003--&gt;</span>          <span class="token comment">&lt;!-- depending on what you're running on your host, this might be noisy--&gt;</span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>0x1FFFFF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">&lt;!--Expect EDRs/AVs to also trigger this--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Rule</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Rule</span> <span class="token attr-name">groupRelation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>and<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetImage</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1003,technique_name=Credential Dumping<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>is<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>C:\Windows\system32\lsass.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetImage</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--Mitre T1098--&gt;</span>          <span class="token comment">&lt;!--Mitre T1550.002--&gt;</span>          <span class="token comment">&lt;!--Mitre T1003--&gt;</span>          <span class="token comment">&lt;!-- depending on what you're running on your host, this might be noisy--&gt;</span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>0x1F1FFF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Rule</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Rule</span> <span class="token attr-name">groupRelation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>and<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetImage</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1003,technique_name=Credential Dumping<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>is<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>C:\Windows\system32\lsass.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetImage</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--Mitre T1098--&gt;</span>          <span class="token comment">&lt;!--Mitre T1550.002--&gt;</span>          <span class="token comment">&lt;!--Mitre T1003--&gt;</span>          <span class="token comment">&lt;!-- depending on what you're running on your host, this might be noisy--&gt;</span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>0x1010<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Rule</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Rule</span> <span class="token attr-name">groupRelation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>and<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetImage</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1003,technique_name=Credential Dumping<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>is<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>C:\Windows\system32\lsass.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetImage</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!--Mitre T1098--&gt;</span>          <span class="token comment">&lt;!--Mitre T1550.002--&gt;</span>          <span class="token comment">&lt;!--Mitre T1003--&gt;</span>          <span class="token comment">&lt;!-- depending on what you're running on your host, this might be noisy--&gt;</span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>0x143A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GrantedAccess</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Rule</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Rule</span> <span class="token attr-name">groupRelation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>and<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetImage</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1003,technique_name=Credential Dumping<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>lsass.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetImage</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">&lt;!--https://pentestlab.blog/2018/05/15/lateral-movement-winrm/--&gt;</span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SourceImage</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1003,technique_name=Credential Dumping<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>wsmprovhost.exe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SourceImage</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Rule</span> <span class="token attr-name">groupRelation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>and<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1055,technique_name=Process Injection<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SourceImage</span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contains all<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>C:\Program Files;\Microsoft Office\Root\Office<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SourceImage</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CallTrace</span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contains<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>\Microsoft Shared\VBA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CallTrace</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Rule</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Rule</span> <span class="token attr-name">groupRelation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>and<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- https://medium.com/falconforce/falconfriday-direct-system-calls-and-cobalt-strike-bofs-0xff14-741fa8e1bdd6 --&gt;</span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CallTrace</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1055,technique_name=Process Injection<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>not begin with<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>C:\Windows\SYSTEM32\ntdll.dll<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CallTrace</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CallTrace</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1055,technique_name=Process Injection<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>not begin with<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>C:\Windows\SYSTEM32\win32u.dll<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CallTrace</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CallTrace</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1055,technique_name=Process Injection<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>not begin with<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>C:\Windows\SYSTEM32\wow64win.dll<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CallTrace</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Rule</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ProcessAccess</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RuleGroup</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EventFiltering</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Sysmon</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Sysmon</span> <span class="token attr-name">schemaversion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4.30<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EventFiltering</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RuleGroup</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">groupRelation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>or<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RegistryEvent</span> <span class="token attr-name">onmatch</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>include<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetObject</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1047,technique_name=Windows Management Instrumentation<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contains<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>SYSTEM\CurrentControlSet\Control\CrashControl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetObject</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--MDE--&gt;</span><span class="token comment">&lt;!-- Win32_OSRecoveryConfiguration class C2 maps to a change in values within the following key: --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetObject</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1047,technique_name=Windows Management Instrumentation<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contains all<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>HKLM\SYSTEM\;Control\WMI\autologger\senseauditlogger<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetObject</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--MDE--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetObject</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1047,technique_name=Windows Management Instrumentation<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contains all<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>HKLM\SYSTEM\;Control\WMI\autologger\senseeventlog<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetObject</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--MDE--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetObject</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1047,technique_name=Windows Management Instrumentation<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contains all<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>HKLM\SYSTEM\;Control\WMI\EtwMaxLoggers<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetObject</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--MDE--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TargetObject</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>technique_id=T1047,technique_name=Windows Management Instrumentation<span class="token punctuation">"</span></span> <span class="token attr-name">condition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>contains all<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>HKLM\SYSTEM\;Control\WMI\Security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TargetObject</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--MDE--&gt;</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RegistryEvent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RuleGroup</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EventFiltering</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Sysmon</span><span class="token punctuation">&gt;</span></span>
</code><button class="copy-code-button">Copy</button></pre></div></div></div></div></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="User and Agent Management" dir="auto" class="heading" id="User_and_Agent_Management">User and Agent Management</h1><div class="heading-children"><div class="el-h2 heading-wrapper"><h2 data-heading="Creating users in Wazuh dashboard" dir="auto" class="heading" id="Creating_users_in_Wazuh_dashboard"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Creating users in Wazuh dashboard</h2><div class="heading-children"><div class="el-div"><div data-callout-metadata="" data-callout-fold="" data-callout="important" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path></svg></div><div class="callout-title-inner">Important</div></div><div class="callout-content">
<p dir="auto">If you would like to limit access, or change to a user account using a different password, then steps below can be followed  </p>
</div></div></div><div class="el-ol"><ol>
<li data-line="0" dir="auto">Go to the ‘hamburger’ in the top left corner</li>
<li data-line="1" dir="auto">Scroll down to the <strong>Dashboard management</strong> &gt; <strong>Security</strong></li>
</ol></div></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Removing an agent from the Wazuh manager" dir="auto" class="heading" id="Removing_an_agent_from_the_Wazuh_manager"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Removing an agent from the Wazuh manager</h2><div class="heading-children"></div></div><div class="el-h2 heading-wrapper"><h2 data-heading="Links to resources used:" dir="auto" class="heading" id="Links_to_resources_used:"><div class="heading-collapse-indicator collapse-indicator collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div>Links to resources used:</h2><div class="heading-children"><div class="el-p"><p dir="auto"><a rel="noopener nofollow" class="external-link" href="https://www.youtube.com/watch?v=f2nRDbwI620" target="_blank">https://www.youtube.com/watch?v=f2nRDbwI620</a><br>
<a rel="noopener nofollow" class="external-link" href="https://github.com/WaterExecution/vulnerable-AD-plus/blob/master/vulnadplus.ps1" target="_blank">https://github.com/WaterExecution/vulnerable-AD-plus/blob/master/vulnadplus.ps1</a><br>
<a rel="noopener nofollow" class="external-link" href="https://www.linkedin.com/feed/update/urn:li:activity:7203009970085195777/" target="_blank">https://www.linkedin.com/feed/update/urn:li:activity:7203009970085195777/</a><br>
<a rel="noopener nofollow" class="external-link" href="https://drive.google.com/file/d/1KcWMCgyH0UdABaZwpPIZ49AJZCxOaA8J/view" target="_blank">https://drive.google.com/file/d/1KcWMCgyH0UdABaZwpPIZ49AJZCxOaA8J/view</a></p></div><div class="el-p"><span style="display: block; margin-block-start: var(--p-spacing); margin-block-end: var(--p-spacing);"><span alt="Created By Info" src="Created By Info" class="internal-embed markdown-embed inline-embed is-loaded"><div class="embed-title markdown-embed-title">Created By Info</div><div class="markdown-embed-content node-insert-event"><div class="markdown-preview-view markdown-rendered node-insert-event show-indentation-guide allow-fold-headings allow-fold-lists"><div class="markdown-preview-sizer markdown-preview-section" style="padding-bottom: 0px; min-height: 237px;"><div class="markdown-preview-pusher" style="width: 1px; height: 0.1px; margin-bottom: 0px;"></div><div class="mod-header mod-ui"></div><div class="el-blockquote"><blockquote dir="auto">
<p>Chris Adams<br>
Gmail: <a data-tooltip-position="top" aria-label="mailto:c.adams612@gmail.com" rel="noopener nofollow" class="external-link" href="mailto:c.adams612@gmail.com" target="_blank">c.adams612@gmail.com</a><br>
Proton: <a data-tooltip-position="top" aria-label="mailto:chris.cybertech@proton.me" rel="noopener nofollow" class="external-link" href="mailto:chris.cybertech@proton.me" target="_blank">chris.cybertech@proton.me</a><br>
LinkedIn: <a rel="noopener nofollow" class="external-link" href="https://www.linkedin.com/in/christoph-adams/" target="_blank">https://www.linkedin.com/in/christoph-adams/</a><br>
GitHub: <a rel="noopener nofollow" class="external-link" href="https://github.com/chris-adams-tech/" target="_blank">https://github.com/chris-adams-tech/</a></p>
</blockquote></div><div> <footer>
        <p dir="auto">© 2024 Chris Adams. All rights reserved.</p>
	    <p dir="auto">Stayin' fossy and saucy. ☀🌴༼▀̿ Ĺ̯▀̿༽</p>
        <nav>
            <ul class="has-list-bullet">
                <li dir="auto"><span class="list-bullet"></span><a href="/terms-and-conditions.html" target="_blank" rel="noopener nofollow">Terms of Service</a></li>
                <li dir="auto"><span class="list-bullet"></span><a href="/about/writeup-created-by-info.html" target="_blank" rel="noopener nofollow">Contact</a></li>
            </ul>
        </nav>
</footer></div></div></div></div><div class="markdown-embed-content node-insert-event" style="display: none;"></div><div class="markdown-embed-link" aria-label="Open link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></div></span></span></div><div class="mod-footer mod-ui"></div></div></div></div></div></div></div></div><div class="sidebar-right sidebar"><div class="sidebar-handle"></div><div class="sidebar-topbar"><div class="topbar-content"></div><div class="clickable-icon sidebar-collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="M21 3H3C1.89543 3 1 3.89543 1 5V19C1 20.1046 1.89543 21 3 21H21C22.1046 21 23 20.1046 23 19V5C23 3.89543 22.1046 3 21 3Z"></path><path d="M10 4V20"></path><path d="M4 7H7"></path><path d="M4 10H7"></path><path d="M4 13H7"></path></svg></div></div><div class="sidebar-content"><div class="graph-view-wrapper"><div class="sidebar-section-header">Interactive Graph</div><div class="graph-view-placeholder">
		<div class="graph-view-container">
			<div class="graph-icon graph-expand" role="button" aria-label="Expand" data-tooltip-position="top"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg></div>
			<canvas id="graph-canvas" class="hide" width="512px" height="512px"></canvas>
		</div>
		</div></div><div class="tree-container mod-root nav-folder tree-item outline-tree" data-depth="0"><div class="tree-header"><span class="sidebar-section-header">Table Of Contents</span><button class="clickable-icon collapse-tree-button" aria-label="Collapse All"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg></button></div><div class="tree-scroll-area tree-item-children nav-folder-children"><div class="tree-item mod-tree-folder nav-folder mod-collapsible is-collapsed" style="display: none;"></div><div class="tree-item" data-depth="1"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Secretcon Active Directory server build (WIP)"><div class="tree-item-contents heading-link" heading-name="Secretcon Active Directory server build (WIP)"><span class="tree-item-title">Secretcon Active Directory server build (WIP)</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#A_bit_about_this_project"><div class="tree-item-contents heading-link" heading-name="A bit about this project"><span class="tree-item-title">A bit about this project</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Tools_used_in_this_project"><div class="tree-item-contents heading-link" heading-name="Tools used in this project"><span class="tree-item-title">Tools used in this project</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Some_good_prior_knowledge_to_have"><div class="tree-item-contents heading-link" heading-name="Some good prior knowledge to have"><span class="tree-item-title">Some good prior knowledge to have</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Active_Directory_Set_up"><div class="tree-item-contents heading-link" heading-name="Active Directory Set up"><span class="tree-item-title">Active Directory Set up</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Windows_Server_download"><div class="tree-item-contents heading-link" heading-name="Windows Server download"><span class="tree-item-title">Windows Server download</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Steps_if_installing_with_the_GUI_desktop_experience"><div class="tree-item-contents heading-link" heading-name="Steps if installing with the GUI desktop experience"><span class="tree-item-title">Steps if installing with the GUI desktop experience</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Sysmon_Installation"><div class="tree-item-contents heading-link" heading-name="Sysmon Installation"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Sysmon Installation</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Desktop_Instructions"><div class="tree-item-contents heading-link" heading-name="Desktop Instructions"><span class="tree-item-title">Desktop Instructions</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="3"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Enable_PowerShell_Module_Logging_and_other_GPO_settings"><div class="tree-item-contents heading-link" heading-name="Enable PowerShell Module Logging and other GPO settings"><span class="tree-item-title">Enable PowerShell Module Logging and other GPO settings</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Download_the_PowerShell_script"><div class="tree-item-contents heading-link" heading-name="Download the PowerShell script"><span class="tree-item-title">Download the PowerShell script</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Install_Wazuh"><div class="tree-item-contents heading-link" heading-name="Install Wazuh"><span class="tree-item-title">Install Wazuh</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item mod-collapsible" data-depth="2"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Installing_Wazuh_dashboard"><div class="tree-item-contents heading-link" heading-name="Installing Wazuh dashboard"><div class="collapse-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon right-triangle"><path d="M3 8L12 17L21 8"></path></svg></div><span class="tree-item-title">Installing Wazuh dashboard</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="3"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Now,_shift_back_to_the_domain_controller_with_Active_Directory"><div class="tree-item-contents heading-link" heading-name="Now, shift back to the domain controller with Active Directory"><span class="tree-item-title">Now, shift back to the domain controller with Active Directory</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div><div class="tree-item" data-depth="1"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#User_and_Agent_Management"><div class="tree-item-contents heading-link" heading-name="User and Agent Management"><span class="tree-item-title">User and Agent Management</span></div></a><div class="tree-item-children nav-folder-children"><div class="tree-item" data-depth="2"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Creating_users_in_Wazuh_dashboard"><div class="tree-item-contents heading-link" heading-name="Creating users in Wazuh dashboard"><span class="tree-item-title">Creating users in Wazuh dashboard</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Removing_an_agent_from_the_Wazuh_manager"><div class="tree-item-contents heading-link" heading-name="Removing an agent from the Wazuh manager"><span class="tree-item-title">Removing an agent from the Wazuh manager</span></div></a><div class="tree-item-children nav-folder-children"></div></div><div class="tree-item" data-depth="2"><a class="tree-link" href="projects\secretcon-active-directory-server-build-(wip).html#Links_to_resources_used:"><div class="tree-item-contents heading-link" heading-name="Links to resources used:"><span class="tree-item-title">Links to resources used:</span></div></a><div class="tree-item-children nav-folder-children"></div></div></div></div></div></div></div><script defer="">let rs = document.querySelector(".sidebar-right"); rs.classList.add("is-collapsed"); if (window.innerWidth > 768) rs.classList.remove("is-collapsed"); rs.style.setProperty("--sidebar-width", localStorage.getItem("sidebar-right-width"));</script></div></div></body></html>